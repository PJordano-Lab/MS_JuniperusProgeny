mean_scat_ERUB<-mean(rela_data_ERUB_scat$relatedness)
se_scat_ERUB<-sd(rela_data_ERUB_scat$relatedness)
length(rela_data_ERUB_scat$seed_A)
rela_data_TPHI_scat<- subset(x = rela_data,
subset = labcode_A == labcode_B &
disperser_A =="Turdus philomelos" &
disperser_B == "Turdus philomelos")
mean_scat_TPHI<-mean(rela_data_TPHI_scat$relatedness)
se_scat_TPHI<-sd(rela_data_TPHI_scat$relatedness)
length(rela_data_TPHI_scat$seed_A)
rela_data_TMER_scat<- subset(x = rela_data,
subset = labcode_A == labcode_B &
disperser_A =="Turdus merula" &
disperser_B == "Turdus merula")
mean_scat_TMER<-mean(rela_data_TMER_scat$relatedness)
se_scat_TMER<-sd(rela_data_TMER_scat$relatedness)
length(rela_data_TMER_scat$seed_A)
rela_data_VVUL_scat<- subset(x = rela_data,
subset = labcode_A == labcode_B &
disperser_A =="Vulpes vulpes" &
disperser_B == "Vulpes vulpes")
mean_scat_VVUL<-mean(rela_data_VVUL_scat$relatedness)
se_scat_VVUL<-sd(rela_data_VVUL_scat$relatedness)
length(rela_data_VVUL_scat$seed_A)
rela_data_SATR_scat<- subset(x = rela_data,
subset = labcode_A == labcode_B &
disperser_A =="Sylvia atricapilla" &
disperser_B == "Sylvia atricapilla")
mean_scat_SATR<-mean(rela_data_SATR_scat$relatedness)
se_scat_SATR<-sd(rela_data_SATR_scat$relatedness)
length(rela_data_SATR_scat$seed_A)
rela_data_CCHL_scat<- subset(x = rela_data,
subset = labcode_A == labcode_B &
disperser_A =="Chloris chloris" &
disperser_B == "Chloris chloris")
mean_scat_CCHL<-mean(rela_data_CCHL_scat$relatedness)
se_scat_CCHL<-sd(rela_data_CCHL_scat$relatedness)
length(rela_data_CCHL_scat$seed_A)
rela_data_TILI_scat<- subset(x = rela_data,
subset = labcode_A == labcode_B &
disperser_A =="Turdus illiacus" &
disperser_B == "Turdus illiacus")
rela_data_TTOR_scat<- subset(x = rela_data,
subset = labcode_A == labcode_B &
disperser_A =="Turdus torquatus" &
disperser_B == "Turdus torquatus")
mean_scat_TTOR<-mean(rela_data_TTOR_scat$relatedness)
se_scat_TTOR<-sd(rela_data_TTOR_scat$relatedness)
length(rela_data_TTOR_scat$seed_A)
rela_data_CCYA_scat<- subset(x = rela_data,
subset = labcode_A == labcode_B &
disperser_A =="Cyanopica cyanus" &
disperser_B == "Cyanopica cyanus")
mean_scat_CCYA<-mean(rela_data_CCYA_scat$relatedness)
se_scat_CCYA<-sd(rela_data_CCYA_scat$relatedness)
length(rela_data_CCYA_scat$seed_A)
rela_data_CELA_scat<- subset(x = rela_data,
subset = labcode_A == labcode_B &
disperser_A =="Cervus elaphus" &
disperser_B == "Cervus elaphus")
mean_scat_CELA<-mean(rela_data_CELA_scat$relatedness)
se_scat_CELA<-sd(rela_data_CELA_scat$relatedness)
length(rela_data_CELA_scat$seed_A)
#Creating final dataframe within scat relatedness
names<-c("Erithacus rubecola", "Turdus philomelos","Turdus merula","Vulpes vulpes","Sylvia atricapilla","Chloris chloris" , "Turdus torquatus","Cyanopica cyanus", "Cervus elaphus" )
mean_rela_within_scat <- c(mean_scat_ERUB,mean_scat_TPHI,mean_scat_TMER,mean_scat_VVUL,mean_scat_SATR, mean_scat_CCHL,mean_scat_TTOR,mean_scat_CCYA,mean_scat_CELA)
se_rela_within_scat <- c(se_scat_ERUB,se_scat_TPHI,se_scat_TMER,se_scat_VVUL,se_scat_SATR, se_scat_CCHL,se_scat_TTOR,se_scat_CCYA,se_scat_CELA)
pairwise_comparations_scat<-c(length(rela_data_ERUB_scat$seed_A), length(rela_data_TPHI_scat$seed_A),length(rela_data_TMER_scat$seed_A),length(rela_data_VVUL_scat$seed_A),length(rela_data_SATR_scat$seed_A),length(rela_data_CCHL_scat$seed_A),length(rela_data_TTOR_scat$seed_A),length(rela_data_CCYA_scat$seed_A),length(rela_data_CELA_scat$seed_A))
data_within_scat<-data.frame(names,mean_rela_within_scat,se_rela_within_scat,pairwise_comparations_scat)
data_within_scat$pairwise_comparations_scat<-as.numeric(data_within_scat$pairwise_comparations_scat) # Data for table 1
colnames(data_within_scat)[1]  <- "disperser"
colnames(data_within_scat)[2]  <- "mean_rela_within_sca"
colnames(data_within_scat)[3]  <- "se_rela_within_scat"
colnames(data_within_scat)[4]  <- "pairwise_comparations_scat"
rela_data_ERUB_trap<- subset(x = rela_data,
subset = ind_A == ind_B &
disperser_A =="Erithacus rubecula" &
disperser_B == "Erithacus rubecula")
mean_within_trap_ERUB<-mean(rela_data_ERUB_trap$relatedness)
se_within_trap_ERUB<-sd(rela_data_ERUB_trap$relatedness)
length(rela_data_ERUB_trap$seed_A)
rela_data_TPHI_trap<- subset(x = rela_data,
subset = ind_A == ind_B  &
disperser_A =="Turdus philomelos" &
disperser_B == "Turdus philomelos")
mean_within_trap_TPHI<-mean(rela_data_TPHI_trap$relatedness)
se_within_trap_TPHI<-sd(rela_data_TPHI_trap$relatedness)
length(rela_data_TPHI_trap$seed_A)
rela_data_TMER_trap<- subset(x = rela_data,
subset = ind_A == ind_B  &
disperser_A =="Turdus merula" &
disperser_B == "Turdus merula")
mean_within_trap_TMER<-mean(rela_data_TMER_trap$relatedness)
se_within_trap_TMER<-sd(rela_data_TMER_trap$relatedness)
length(rela_data_TMER_trap$seed_A)
rela_data_VVUL_trap<- subset(x = rela_data,
subset = ind_A == ind_B  &
disperser_A =="Vulpes vulpes" &
disperser_B == "Vulpes vulpes")
mean_within_trap_VVUL<-mean(rela_data_VVUL_trap$relatedness)
se_within_trap_VVUL<-sd(rela_data_VVUL_trap$relatedness)
length(rela_data_VVUL_trap$seed_A)
rela_data_SATR_trap<- subset(x = rela_data,
subset = ind_A == ind_B  &
disperser_A =="Sylvia atricapilla" &
disperser_B == "Sylvia atricapilla")
mean_within_trap_SATR<-mean(rela_data_SATR_trap$relatedness)
se_within_trap_SATR<-sd(rela_data_SATR_trap$relatedness)
length(rela_data_SATR_trap$seed_A)
rela_data_CCHL_trap<- subset(x = rela_data,
subset = ind_A == ind_B  &
disperser_A =="Chloris chloris" &
disperser_B == "Chloris chloris")
mean_within_trap_CCHL<-mean(rela_data_CCHL_trap$relatedness)
se_within_trap_CCHL<-sd(rela_data_CCHL_trap$relatedness)
length(rela_data_CCHL_trap$seed_A)
rela_data_TILI_trap<- subset(x = rela_data,
subset = ind_A == ind_B  &
disperser_A =="Turdus iliacus" &
disperser_B == "Turdus iliacus")
rela_data_TTOR_trap<- subset(x = rela_data,
subset = ind_A == ind_B  &
disperser_A =="Turdus torquatus" &
disperser_B == "Turdus torquatus")
mean_within_trap_TTOR<-mean(rela_data_TTOR_trap$relatedness)
se_within_trap_TTOR<-sd(rela_data_TTOR_trap$relatedness)
length(rela_data_TTOR_trap$seed_A)
rela_data_CCYA_trap<- subset(x = rela_data,
subset = ind_A == ind_B  &
disperser_A == "Cyanopica cyanus" &
disperser_B == "Cyanopica cyanus")
mean_within_trap_CCYA<-mean(rela_data_CCYA_trap$relatedness)
se_within_trap_CCYA<-sd(rela_data_CCYA_trap$relatedness)
length(rela_data_CCYA_trap$seed_A)
rela_data_CELA_trap<- subset(x = rela_data,
subset = ind_A == ind_B  &
disperser_A == "Cervus elaphus" &
disperser_B == "Cervus elaphus")
mean_within_trap_CELA<-mean(rela_data_CELA_trap$relatedness)
se_within_trap_CELA<-sd(rela_data_CELA_trap$relatedness)
length(rela_data_CELA_trap$seed_A)
#Creating final dataframe within traps relatedness
mean_rela_within_TRAP <- c(mean_within_trap_ERUB,mean_within_trap_TPHI,mean_within_trap_TMER,mean_within_trap_VVUL,mean_within_trap_SATR, mean_within_trap_CCHL,mean_within_trap_TTOR,mean_within_trap_CCYA,mean_within_trap_CELA)
se_rela_within_TRAP <- c(se_within_trap_ERUB,se_within_trap_TPHI,se_within_trap_TMER,se_within_trap_VVUL,se_within_trap_SATR, se_within_trap_CCHL,se_within_trap_TTOR,se_within_trap_CCYA,se_within_trap_CELA)
pairwise_comparations_within_trap<-c(length(rela_data_ERUB_trap$seed_A), length(rela_data_TPHI_trap$seed_A),length(rela_data_TMER_trap$seed_A),length(rela_data_VVUL_trap$seed_A),length(rela_data_SATR_trap$seed_A),length(rela_data_CCHL_trap$seed_A),length(rela_data_TTOR_trap$seed_A),length(rela_data_CCYA_trap$seed_A),length(rela_data_CELA_trap$seed_A))
data_within_trap<-data.frame(names,mean_rela_within_TRAP,se_rela_within_TRAP,pairwise_comparations_within_trap)
data_within_trap$pairwise_comparations_within_trap<-as.numeric(data_within_trap$pairwise_comparations_within_trap) #Data for table 1
colnames(data_within_trap)[1]  <- "disperser"
colnames(data_within_trap)[2]  <- "mean_rela_within_trap"
colnames(data_within_trap)[3]  <- "se_rela_within_trap"
colnames(data_within_trap)[4]  <- "pairwise_comparations_trap"
rela_data_ERUB_among_traps<- subset(x = rela_data,
subset = ind_A != ind_B & area_A == area_B &
disperser_A =="Erithacus rubecula" &
disperser_B == "Erithacus rubecula")
mean_among_trap_ERUB<-mean(rela_data_ERUB_among_traps$relatedness)
se_among_trap_ERUB<-sd(rela_data_ERUB_among_traps$relatedness)
length(rela_data_ERUB_among_traps$seed_A)
rela_data_TPHI_among_traps<- subset(x = rela_data,
subset = ind_A != ind_B & area_A == area_B &
disperser_A =="Turdus philomelos" &
disperser_B == "Turdus philomelos")
mean_among_trap_TPHI<-mean(rela_data_TPHI_among_traps$relatedness)
se_among_trap_TPHI<-sd(rela_data_TPHI_among_traps$relatedness)
length(rela_data_TPHI_among_traps$seed_A)
rela_data_TMER_among_traps<- subset(x = rela_data,
subset = ind_A != ind_B  & area_A == area_B &
disperser_A =="Turdus merula" &
disperser_B == "Turdus merula")
mean_among_trap_TMER<-mean(rela_data_TMER_among_traps$relatedness)
se_among_trap_TMER<-sd(rela_data_TMER_among_traps$relatedness)
length(rela_data_TMER_among_traps$seed_A)
rela_data_VVUL_among_traps<- subset(x = rela_data,
subset = ind_A != ind_B  & area_A == area_B &
disperser_A =="Vulpes vulpes" &
disperser_B == "Vulpes vulpes")
mean_among_trap_VVUL<-mean(rela_data_VVUL_among_traps$relatedness)
se_among_trap_VVUL<-sd(rela_data_VVUL_among_traps$relatedness)
length(rela_data_VVUL_among_traps$seed_A)
rela_data_SATR_among_traps<- subset(x = rela_data,
subset = ind_A != ind_B & area_A == area_B &
disperser_A =="Sylvia atricapilla" &
disperser_B == "Sylvia atricapilla")
mean_among_trap_SATR<-mean(rela_data_SATR_among_traps$relatedness)
se_among_trap_SATR<-sd(rela_data_SATR_among_traps$relatedness)
length(rela_data_SATR_among_traps$seed_A)
rela_data_CCHL_among_traps<- subset(x = rela_data,
subset = ind_A != ind_B &  area_A == area_B &
disperser_A =="Chloris chloris" &
disperser_B == "Chloris chloris")
mean_among_trap_CCHL<-mean(rela_data_CCHL_among_traps$relatedness)
se_among_trap_CCHL<-sd(rela_data_CCHL_among_traps$relatedness)
length(rela_data_CCHL_among_traps$seed_A)
rela_data_TILI_among_traps<- subset(x = rela_data,
subset = ind_A != ind_B & area_A == area_B &
disperser_A =="Turdus iliacus" &
disperser_B == "Turdus iliacus")
mean_among_trap_TILI<-mean(rela_data_TILI_among_traps$relatedness)
se_among_trap_TILI<-sd(rela_data_TILI_among_traps$relatedness)
length(rela_data_TILI_among_traps$seed_A)
rela_data_TTOR_among_traps<- subset(x = rela_data,
subset = ind_A != ind_B & area_A == area_B &
disperser_A =="Turdus torquatus" &
disperser_B == "Turdus torquatus")
mean_among_trap_TTOR<-mean(rela_data_TTOR_among_traps$relatedness)
se_among_trap_TTOR<-sd(rela_data_TTOR_among_traps$relatedness)
length(rela_data_TTOR_among_traps$seed_A)
rela_data_CCYA_among_traps<- subset(x = rela_data,
subset = ind_A != ind_B & area_A == area_B &
disperser_A =="Cyanopica cyanus" &
disperser_B == "Cyanopica cyanus")
mean_among_trap_CCYA<-mean(rela_data_CCYA_among_traps$relatedness)
se_among_trap_CCYA<-sd(rela_data_CCYA_among_traps$relatedness)
length(rela_data_CCYA_among_traps$seed_A)
rela_data_CELA_among_traps<- subset(x = rela_data,
subset = ind_A != ind_B & area_A == area_B &
disperser_A =="Cervus elaphus" &
disperser_B == "Cervus elaphus")
mean_among_trap_CELA<-mean(rela_data_CELA_among_traps$relatedness)
se_among_trap_CELA<-sd(rela_data_CELA_among_traps$relatedness)
length(rela_data_CELA_among_traps$seed_A)
#Creating final dataframe among traps relatedness
mean_rela_among_TRAP <- c(mean_among_trap_ERUB,mean_among_trap_TPHI,mean_among_trap_TMER,mean_among_trap_VVUL,mean_among_trap_SATR, mean_among_trap_CCHL,mean_among_trap_TTOR,mean_among_trap_CCYA,mean_among_trap_CELA)
se_rela_among_TRAP <- c(se_among_trap_ERUB,se_among_trap_TPHI,se_among_trap_TMER,se_among_trap_VVUL,se_among_trap_SATR, se_among_trap_CCHL,se_among_trap_TTOR,se_among_trap_CCYA,se_among_trap_CELA)
pairwise_comparations_among_trap<-c(length(rela_data_ERUB_among_traps$seed_A), length(rela_data_TPHI_among_traps$seed_A),length(rela_data_TMER_among_traps$seed_A),length(rela_data_VVUL_among_traps$seed_A),length(rela_data_SATR_among_traps$seed_A),length(rela_data_CCHL_among_traps$seed_A),length(rela_data_TTOR_among_traps$seed_A),length(rela_data_CCYA_among_traps$seed_A),length(rela_data_CELA_among_traps$seed_A))
data_among_trap<-data.frame(names,mean_rela_among_TRAP,se_rela_among_TRAP,pairwise_comparations_among_trap)
data_among_trap$pairwise_comparations_among_trap<-as.numeric(data_among_trap$pairwise_comparations_among_trap) #Data for Table 1
colnames(data_among_trap)[1]  <- "disperser"
colnames(data_among_trap)[2]  <- "mean_rela_among_TRAP"
colnames(data_among_trap)[3]  <- "se_rela_among_TRAP"
colnames(data_among_trap)[4]  <- "pairwise_comparations_among_trap"
data_within_scat
data_within_trap
data_among_trap
relatedness_results<-merge(data_within_scat,data_within_trap)
relatedness_results<-merge(relatedness_results, data_among_trap)
relatedness_results<-as.data.frame(relatedness_results)
relatedness_results<-relatedness_results %>% dplyr::filter(disperser %in% c("Erithacus rubecola","Turdus merula", "Turdus philomelos", "Vulpes vulpes"))
relatedness_results
library(dplyr)
dataset_H<- dataset %>% group_by(ind, microhabitat, area) %>%  dplyr::summarise( n_seeds = n(),n_mothers = n_distinct(geno_profile))
#hist(dataset_H$n_seeds)
library(plotrix)
dataset_HH<-ddply(dataset_H, .(area, microhabitat), summarize, mean_n_seeds=mean(n_seeds),SE_n_seeds= std.error(n_seeds),mean_n_mothers=mean(n_mothers),SE_n_mothers= std.error(n_mothers) )
knitr::opts_chunk$set(echo = TRUE)
dataset_I<- dataset %>% group_by(ind, microhabitat, area, geno_profile) %>%  dplyr::summarise( n_seeds_profile = n())
mothers<-dataset_I %>% summarise(n_mothers = n_distinct(geno_profile))
# Numerator
column_nominador<- dataset_I$n_seeds_profile * (dataset_I$n_seeds_profile-1)
dataset_II<-cbind(dataset_I,pmi_numerator = column_nominador)
#Denominator
column_denominador<- dataset_I %>% group_by(ind) %>% dplyr::summarise(n_seeds_total = sum(n_seeds_profile))
column_denominador_dataset<-cbind(column_denominador, column_denominador$n_seeds_total * (column_denominador$n_seeds_total - 1))
#Estimating uPMI
dataset_III<-merge(dataset_II,column_denominador_dataset)
colnames(dataset_III)[8] <-"pmi_denominator"
fraction_uPMI<- dataset_III$pmi_numerator / dataset_III$pmi_denominator
dataset_III<-cbind(dataset_III,fraction_uPMI)
dataset_IIII<- dataset_III %>% group_by(ind, microhabitat,area) %>% dplyr:: summarise( uPMI = sum(fraction_uPMI)) # Here it is!
#I do not used ALPHA in the manuscript
#Estimating ALPHA diversity following (Scofield et al 2012) Rgg^-1. I t is also the Number of effective source trees
dataset_IIIII<- cbind(dataset_IIII, alpha = dataset_IIII$uPMI^-1)  # Here it is!
dataset_IIIII<-cbind(dataset_IIIII, column_denominador$n_seeds_total)
colnames(dataset_IIIII)[6] <-"n_seeds_total"
dataset_IIIII<-cbind(dataset_IIIII , mothers$n_mothers)
colnames(dataset_IIIII)[7] <-"n_mothers"
dataset_IIIII
dataset_IIIII # data uPMI + ALPHA +n_seeds + n_mothers
# Preparing relatednes per deposition site
reltedness_trap_A<- subset(x = rela_data,
subset = ind_A == ind_B)
reltedness_trap<- reltedness_trap_A %>% group_by(area_A,mh_A, ind_A) %>% summarise( mean_relatedness = mean(relatedness))
reltedness_trap<-as.data.frame(reltedness_trap)
reltedness_trap$mean_relatedness<-as.numeric(reltedness_trap$mean_relatedness)
reltedness_trap$ind_A<-as.character(reltedness_trap$ind_A)
colnames(reltedness_trap)[1] <- "area"
colnames(reltedness_trap)[2] <- "microhabitat"
colnames(reltedness_trap)[3] <- "ind"
reltedness_trap<-reltedness_trap[reltedness_trap$ind != "NA", ] # I remove here again the unlocalized V.vulpes sample
#Merging relatedness per point with dataset glm
dataset_properties<-merge(dataset_IIIII, reltedness_trap)
dataset_properties<-as.data.frame(dataset_properties)
colnames(dataset_properties)[2] <- "mh"
dataset_properties<-as.data.frame(dataset_properties)
dataset_properties$mh<-as.factor(dataset_properties$mh)
dataset_properties$area<-as.factor(dataset_properties$area)
dataset_properties$uPMI<-as.numeric(dataset_properties$uPMI)
dataset_properties$alpha<-as.numeric(dataset_properties$alpha)
dataset_properties$n_seeds_total<-as.numeric(dataset_properties$n_seeds_total)
dataset_properties$n_mothers<-as.numeric(dataset_properties$n_mothers)
dataset_properties$mean_relatedness<-as.numeric(dataset_properties$mean_relatedness)
dataset_properties_matrix<-select(dataset_properties,n_seeds_total, n_mothers, uPMI, alpha, mean_relatedness)
dataset_properties_matrix<-dataset_properties_matrix[dataset_properties_matrix$n_seeds > 5, ]
#Test correlation among the number of seeds and the maternal components of the seed rain
mt.cor<-cor(dataset_properties_matrix, method = "pearson")
corrplot:: corrplot(mt.cor)
#fit nested ANOVA for Maternal richness
nest_mothers <- aov(dataset_properties$n_mothers ~ dataset_properties$area*dataset_properties$mh+  dataset_properties$area / factor(dataset_properties$mh))
summary(nest_mothers)
hist(nest_mothers$residuals) # Assumptions OK
# Plotting
ggplot(dataset_properties, aes(x=mh, y=n_mothers, fill=mh)) +
geom_boxplot(alpha = 0.6, colour = "black") + scale_fill_manual(values = col_mh)  + theme_bw() + labs(y = "Maternal richness", x = "Area")
tuk<- TukeyHSD(nest_mothers)
tuk
#plot(TukeyHSD(nest_mothers))
#fit nested ANOVA for relatedness
nest_rela<- aov(dataset_properties$mean_relatedness ~ dataset_properties$area*dataset_properties$mh+  dataset_properties$area / factor(dataset_properties$mh))
summary(nest_rela)
#hist(nest_rela$residuals) # Assumptions OK
# Plotting
ggplot(dataset_properties, aes(x=mh, y=mean_relatedness, fill=mh)) +
geom_boxplot(alpha = 0.6, colour = "black") + scale_fill_manual(values = col_mh)  + theme_bw() + labs(y = "Mean relatedness", x = "Area")
tuk<- TukeyHSD(nest_rela)
tuk
#plot(TukeyHSD(nest_rela))
#fit nested ANOVA for Maternal redundancy (uPMI)
nest_PMI<- aov(dataset_properties$uPMI ~ dataset_properties$area*dataset_properties$mh+  dataset_properties$area / factor(dataset_properties$mh))
summary(nest_PMI)
#hist(nest_rela$residuals) # Assumptions OK
# Plotting
ggplot(dataset_properties, aes(x=mh, y=log(uPMI), fill=mh)) +
geom_boxplot(alpha = 0.6, colour = "black") + scale_fill_manual(values = col_mh)  + theme_bw() + labs(y = "log-uPMI", x = "Area")
tuk<- TukeyHSD(nest_PMI)
tuk
#plot(TukeyHSD(nest_PMI))
# Histograms of dependent variables
hist(dataset_properties$n_seeds_total)
# Histograms of dependent variables
hist(dataset_properties$n_seeds_total)
hist(dataset_properties$n_mothers)
hist(dataset_properties$uPMI)
hist(dataset_properties$mean_relatedness)
#Contribution of each species tu each microhabitat
dataset_R  <-dataset %>% group_by(ind,disperser,area, microhabitat) %>% dplyr::summarise(n_seeds = n())
dataset_R<-select(dataset_R, ind, n_seeds,-area)
dataset_R<-pivot_wider(dataset_R, names_from = disperser, values_from = n_seeds)
dataset_R <- dataset_R %>% drop_na(ind)
dataset_R[is.na(dataset_R)] <- 0
dataset_cca<-dataset_properties %>% left_join(dataset_R, by = "ind")
dataset_cca<-select(dataset_cca,-area.y)
colnames(dataset_cca)[3] <- "area"
dataset_cca<-as.data.frame(dataset_cca)
dataset_cca<-as.data.frame(dataset_cca)
write.csv(dataset_cca, file = "dataset_cca.csv")
knitr::opts_chunk$set(echo = TRUE)
dataset_K_CYA<-dataset %>% filter( area == "SABCOL" & disperser %in% "Cyanopica cyanus")
CYA_GENO<-n_distinct(dataset_K_CYA$geno_profile)
dataset_K_TIL<-dataset %>% filter( area == "SABCOL" & disperser %in% c("Cyanopica cyanus","Turdus iliacus"))
TIL_GENO<-n_distinct(dataset_K_TIL$geno_profile)
dataset_K_SAT<-dataset %>% filter( area == "SABCOL" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla"))
SAT_GENO<-n_distinct(dataset_K_SAT$geno_profile)
dataset_K_TTOR<-dataset %>% filter( area == "SABCOL" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus"))
TTOR_GENO<-n_distinct(dataset_K_TTOR$geno_profile)
dataset_K_CELA<-dataset %>% filter( area == "SABCOL" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus"))
CELA_GENO<-n_distinct(dataset_K_CELA$geno_profile)
dataset_K_CHL<-dataset %>% filter( area == "SABCOL" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris"))
CHL_GENO<-n_distinct(dataset_K_CHL$geno_profile)
dataset_K_ERI<-dataset %>% filter( area == "SABCOL" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris", "Erithacus rubecula"))
ERI_GENO<-n_distinct(dataset_K_ERI$geno_profile)
dataset_K_MER<-dataset %>% filter( area == "SABCOL" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris", "Erithacus rubecula", "Turdus merula"))
MER_GENO<-n_distinct(dataset_K_MER$geno_profile)
dataset_K_VUL<-dataset %>% filter( area == "SABCOL" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris", "Erithacus rubecula", "Turdus merula", "Vulpes vulpes"))
VUL_GENO<-n_distinct(dataset_K_VUL$geno_profile)
dataset_K_PHI<-dataset %>% filter( area == "SABCOL" & disperser  %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris", "Erithacus rubecula", "Turdus merula", "Vulpes vulpes", "Turdus philomelos"))
PHI_GENO<-n_distinct(dataset_K_PHI$geno_profile)
NO_FRU<-0
Vector_COL<-c(NO_FRU,CYA_GENO,TIL_GENO,SAT_GENO,TTOR_GENO,CELA_GENO, CHL_GENO,ERI_GENO, MER_GENO, VUL_GENO,PHI_GENO)
dataset_K_CYA<-dataset %>% filter( area == "SABOJI" & disperser %in% "Cyanopica cyanus")
CYA_GENO<-n_distinct(dataset_K_CYA$geno_profile)
dataset_K_TIL<-dataset %>% filter( area == "SABOJI" & disperser %in% c("Cyanopica cyanus","Turdus iliacus"))
TIL_GENO<-n_distinct(dataset_K_TIL$geno_profile)
dataset_K_SAT<-dataset %>% filter( area == "SABOJI" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla"))
SAT_GENO<-n_distinct(dataset_K_SAT$geno_profile)
dataset_K_TTOR<-dataset %>% filter( area == "SABOJI" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus"))
TTOR_GENO<-n_distinct(dataset_K_TTOR$geno_profile)
dataset_K_CELA<-dataset %>% filter( area == "SABOJI" & disperser  %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus"))
CELA_GENO<-n_distinct(dataset_K_CELA$geno_profile)
dataset_K_CHL<-dataset %>% filter( area == "SABOJI" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris"))
CHL_GENO<-n_distinct(dataset_K_CHL$geno_profile)
dataset_K_ERI<-dataset %>% filter( area == "SABOJI" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris", "Erithacus rubecula"))
ERI_GENO<-n_distinct(dataset_K_ERI$geno_profile)
dataset_K_MER<-dataset %>% filter( area == "SABOJI" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris", "Erithacus rubecula", "Turdus merula"))
MER_GENO<-n_distinct(dataset_K_MER$geno_profile)
dataset_K_VUL<-dataset %>% filter( area == "SABOJI" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris", "Erithacus rubecula", "Turdus merula", "Vulpes vulpes"))
VUL_GENO<-n_distinct(dataset_K_VUL$geno_profile)
dataset_K_PHI<-dataset %>% filter( area == "SABOJI" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris", "Erithacus rubecula", "Turdus merula", "Vulpes vulpes", "Turdus philomelos"))
PHI_GENO<-n_distinct(dataset_K_PHI$geno_profile)
NO_FRU<-0
Vector_OJI<-c(NO_FRU,CYA_GENO,TIL_GENO,SAT_GENO,TTOR_GENO,CELA_GENO, CHL_GENO,ERI_GENO, MER_GENO, VUL_GENO,PHI_GENO)
dataset_K_CYA<-dataset %>% filter( area == "SABMAR" %in% "Cyanopica cyanus")
CYA_GENO<-n_distinct(dataset_K_CYA$geno_profile)
dataset_K_TIL<-dataset %>% filter( area == "SABMAR" %in% c("Cyanopica cyanus","Turdus iliacus"))
TIL_GENO<-n_distinct(dataset_K_TIL$geno_profile)
dataset_K_SAT<-dataset %>% filter( area == "SABMAR" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla"))
SAT_GENO<-n_distinct(dataset_K_SAT$geno_profile)
dataset_K_TTOR<-dataset %>% filter( area == "SABMAR" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus"))
TTOR_GENO<-n_distinct(dataset_K_TTOR$geno_profile)
dataset_K_CELA<-dataset %>% filter( area == "SABMAR" & disperser  %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus"))
CELA_GENO<-n_distinct(dataset_K_CELA$geno_profile)
dataset_K_CHL<-dataset %>% filter( area == "SABMAR" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris"))
CHL_GENO<-n_distinct(dataset_K_CHL$geno_profile)
dataset_K_ERI<-dataset %>% filter( area == "SABMAR" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris", "Erithacus rubecula"))
ERI_GENO<-n_distinct(dataset_K_ERI$geno_profile)
dataset_K_MER<-dataset %>% filter( area == "SABMAR" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris", "Erithacus rubecula", "Turdus merula"))
MER_GENO<-n_distinct(dataset_K_MER$geno_profile)
dataset_K_VUL<-dataset %>% filter( area == "SABMAR" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris", "Erithacus rubecula", "Turdus merula", "Vulpes vulpes"))
VUL_GENO<-n_distinct(dataset_K_VUL$geno_profile)
dataset_K_PHI<-dataset %>% filter( area == "SABMAR" & disperser %in% c("Cyanopica cyanus","Turdus iliacus","Sylvia atricapilla","Turdus torquatus","Cervus elaphus","Chloris chloris", "Erithacus rubecula", "Turdus merula", "Vulpes vulpes", "Turdus philomelos"))
PHI_GENO<-n_distinct(dataset_K_PHI$geno_profile)
NO_FRU<-0
Vector_MAR<-c(NO_FRU,CYA_GENO,TIL_GENO,SAT_GENO,TTOR_GENO,CELA_GENO, CHL_GENO,ERI_GENO, MER_GENO, VUL_GENO,PHI_GENO)
Vector_COL
Vector_OJI
Vector_MAR
first_column <- c("SABCOL","SABCOL","SABCOL", "SABCOL", "SABCOL", "SABCOL","SABCOL", "SABCOL","SABCOL", "SABCOL","SABCOL","SABOJI","SABOJI", "SABOJI","SABOJI","SABOJI","SABOJI","SABOJI","SABOJI","SABOJI","SABOJI","SABOJI","SABMAR","SABMAR", "SABMAR", "SABMAR", "SABMAR", "SABMAR","SABMAR","SABMAR","SABMAR", "SABMAR", "SABMAR")
second_column <- c(Vector_COL, Vector_OJI,Vector_MAR)
third_column<- c("no", "Cyanopica cyanus", "Turdus iliacus", "Sylvia atricapilla", "Turdus torquatus","Cervus elaphus", "Chloris chloris","Erithacus rubecula", "Turdus merula","Vulpes vulpes", "Turdus philomelos", "no","Cyanopica cyanus", "Turdus iliacus", "Sylvia atricapilla", "Turdus torquatus","Cervus elaphus", "Chloris chloris","Erithacus rubecula", "Turdus merula","Vulpes vulpes", "Turdus philomelos","no","Cyanopica cyanus", "Turdus iliacus", "Sylvia atricapilla", "Turdus torquatus","Cervus elaphus", "Chloris chloris","Erithacus rubecula", "Turdus merula","Vulpes vulpes", "Turdus philomelos")
dataset_KK <- data.frame(first_column, second_column,third_column )
dataset_KK$third_column = factor(dataset_KK$third_column,c("no", "Cyanopica cyanus", "Turdus iliacus", "Sylvia atricapilla", "Turdus torquatus","Cervus elaphus", "Chloris chloris","Erithacus rubecula", "Turdus merula","Vulpes vulpes", "Turdus philomelos"))
col_area <- c("SABCOL"="#ccd5ae", "SABOJI"="#588157", "SABMAR"="#344e41")
legend_title <- "AREA"
ggplot(dataset_KK, aes(x = third_column, y = second_column, color = first_column, group = first_column)) +
geom_point() + geom_line()+ theme(axis.text = element_text(angle = 30))+ theme_bw()+ labs(y = "ACCUMULATED MOTHER RICHNES", x = "FRUGIVORE SPECIES")+ scale_colour_manual(values = col_area) + theme(axis.text.x=element_text(angle=30, hjust=1))
library(ggalluvial)
# create a dataset
#COL
dataset_Z<- dataset %>% group_by(ind, microhabitat, area, geno_profile) %>%  dplyr::summarise( n_seeds_profile = n())
#mothers<-dataset_I %>% summarise(n_mothers = n_distinct(geno_profile))
dataset_Z$n_seeds_profile<-as.numeric(dataset_Z$n_seeds_profile)
dataset_Z$geno_profile<-as.factor(dataset_Z$geno_profile)
dataset_Z_COL<-filter(dataset_Z, area =="SABCOL")
dataset_Z_COL_NOOA<-filter(dataset_Z_COL, microhabitat != "OA")
# Stacked + percent
ele_COL <- dataset_Z_COL_NOOA %>%
group_by(geno_profile) %>%
mutate(n_rep = n()) %>%
mutate(color = ifelse(n_rep > 1, paste0(geno_profile), NA))
COL_shadow<-ggplot(ele_COL, aes(y=n_seeds_profile, x=ind, fill = color)) +
geom_bar(position="fill", stat="identity", color = "black")+ theme(axis.text.x=element_text(angle=30, hjust=1))
#OJI
dataset_Z_COL<-filter(dataset_Z, area =="SABOJI")
dataset_Z_COL_NOOA<-filter(dataset_Z_COL, microhabitat != "OA")
# Stacked + percent
ele_OJI <- dataset_Z_COL_NOOA %>%
group_by(geno_profile) %>%
mutate(n_rep = n()) %>%
mutate(color = ifelse(n_rep > 1, paste0(geno_profile), NA))
OJI_shadow<-ggplot(ele_OJI, aes(y=n_seeds_profile, x=ind, fill = color)) +
geom_bar(position="fill", stat="identity", color = "black")+ theme(axis.text.x=element_text(angle=30, hjust=1))
#MAR
dataset_Z_COL<-filter(dataset_Z, area =="SABMAR")
dataset_Z_COL_NOOA<-filter(dataset_Z_COL, microhabitat != "OA")
ele_MAR <- dataset_Z_COL_NOOA %>%
group_by(geno_profile) %>%
mutate(n_rep = n()) %>%
mutate(color = ifelse(n_rep > 1, paste0(geno_profile), NA))
MAR_shadow<-ggplot(ele_MAR, aes(y=n_seeds_profile, x=ind, fill = color)) +
geom_bar(position="fill", stat="identity", color = "black")+ theme(axis.text.x=element_text(angle=30, hjust=1))
ggarrange(MAR_shadow,OJI_shadow,COL_shadow)
require(GGally)
library(CCP)
require(CCA)
library(candisc)
library(readr)
dataset_cca <- read_csv("dataset_cca.csv")
dataset_cca<-dataset_cca[,-1]
properties_data<- dataset_cca [,c(4,7,8)] # I not included alpha because I have some infinite values.
frugivores_data<-dataset_cca [,c(9,10,11,12,13)]
# Evaluate Collinearity
require(VIF)
source("vif_function.R") # Variance Inflation Factor (VIF) R function from https://github.com/PJordano-Lab/MS_Florencia Florencia M. et al 2017
vif_func(in_frame= frugivores_data, thresh=2, trace=T)
# GREAT! As expected, there is no multicollinearity between predictor variables (frugivores)
correl<-matcor(properties_data, frugivores_data)
img.matcor(correl)
img.matcor(correl,type=2)
cc<-cc(properties_data, frugivores_data)
cc
cc$cor # display the canonical correlations. I found a very strong correlation in the fist dimension
cc[3:4] # raw canonical coefficients. Canonical Weights
ev <- (1 - cc$cor^2)
n <- dim(properties_data)[1]
p <- length(properties_data)
q <- length(frugivores_data)
k <- min(p, q)
m <- n - 3/2 - (p + q)/2
w <- rev(cumprod(rev(ev)))
# initialize
d1 <- d2 <- f <- vector("numeric", k)
for (i in 1:k) {
s <- sqrt((p^2 * q^2 - 4)/(p^2 + q^2 - 5))
si <- 1/s
d1[i] <- p * q
d2[i] <- m * s - p * q/2 + 1
r <- (1 - w[i]^si)/w[i]^si
f[i] <- r * d2[i]/d1[i]
p <- p - 1
q <- q - 1
}
pv <- pf(f, d1, d2, lower.tail = F, log.p=F)
(dmat <- cbind(WilksL = w, F = f, df1 = d1, df2 = d2, p = pv)) # Just the first canonical dimension is significative
plt.cc (cc, d1 = 1, d2= 2,var.label = FALSE, int = 0.5, type = "b", Xnames = TRUE, Ynames = NULL)
plt.cc (cc, d1 = 1, d2= 2,var.label = TRUE, int = 0.5, type = "i", ind.names = dataset_cca$ind, Xnames = NULL, Ynames = NULL)
can_redun<-candisc::redundancy(candisc::cancor(properties_data,frugivores_data))
print(can_redun)
can_redun$Xcan.redun # The firtst canonical variable tell us that the 41.4% of the total variance in 7 (maternla components) is explained by X (frugivores data).
library(candisc)
cc_R2 <- cancor(properties_data,frugivores_data)
cc_R2 # CanRSQ represents
cc_comput<-comput(properties_data,frugivores_data,cc)
cc_comput[3:6]
